<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 石抽卡 Tier List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        .tier-row { min-height: 80px; transition: background 0.2s; }
        .character-item { 
            cursor: pointer; 
            width: 64px; 
            height: 64px; 
            object-fit: cover; 
            transition: all 0.2s; 
            user-select: none;
        }
        /* 選取卡片時的發光效果 */
        .selected-item { 
            outline: 4px solid #facc15; 
            box-shadow: 0 0 20px #facc15; 
            transform: scale(1.15); 
            z-index: 50;
            position: relative;
        }

								
								   
		 

        #comment-box {
            resize: none;
            overflow: hidden;
            min-height: 100px;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-4 md:p-10">

    <div class="max-w-5xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-yellow-500">2025 石抽卡 Tier</h1>
            <p class="text-gray-400 mt-2">操作方式：點擊「卡片」選取 ➔ 點擊「目標區域」放置</p>
        </header>

        <div class="mb-6 flex gap-4 justify-center">
            <button onclick="downloadList()" class="bg-green-600 hover:bg-green-700 px-6 py-2 rounded font-bold transition shadow-lg">下載排行圖 (含評論)</button>
            <button onclick="resetList()" class="bg-red-600 hover:bg-red-700 px-6 py-2 rounded font-bold transition shadow-lg">重置全部數據</button>
        </div>

        <div id="capture-area" class="bg-black p-4 border-2 border-gray-700 shadow-2xl">
            <div id="tier-container" class="flex flex-col gap-1">
                <div class="flex border-b border-gray-800 row-container" onclick="handleRowClick(this)">
                    <div class="w-24 flex items-center justify-center bg-red-500 text-black font-black text-2xl px-2">S</div>
                    <div class="tier-row flex-1 p-2 flex flex-wrap gap-2 bg-gray-800"></div>
                </div>
                <div class="flex border-b border-gray-800 row-container" onclick="handleRowClick(this)">
                    <div class="w-24 flex items-center justify-center bg-orange-400 text-black font-black text-2xl px-2">A</div>
                    <div class="tier-row flex-1 p-2 flex flex-wrap gap-2 bg-gray-800"></div>
                </div>
                <div class="flex border-b border-gray-800 row-container" onclick="handleRowClick(this)">
                    <div class="w-24 flex items-center justify-center bg-yellow-300 text-black font-black text-2xl px-2">B</div>
                    <div class="tier-row flex-1 p-2 flex flex-wrap gap-2 bg-gray-800"></div>
                </div>
                <div class="flex border-b border-gray-800 row-container" onclick="handleRowClick(this)">
                    <div class="w-24 flex items-center justify-center bg-green-400 text-black font-black text-2xl px-2">C</div>
                    <div class="tier-row flex-1 p-2 flex flex-wrap gap-2 bg-gray-800"></div>
                </div>
                <div class="flex border-b border-gray-800 row-container" onclick="handleRowClick(this)">
                    <div class="w-24 flex items-center justify-center bg-blue-400 text-black font-black text-2xl px-2">D</div>
                    <div class="tier-row flex-1 p-2 flex flex-wrap gap-2 bg-gray-800"></div>
                </div>
            </div>

            <div class="mt-6 bg-gray-900 p-4 border border-gray-700 rounded-lg">
                <h3 class="text-yellow-500 font-bold mb-2">評論與心得：</h3>
                <textarea id="comment-box" 
                    class="w-full bg-black text-gray-200 p-3 border border-gray-600 rounded focus:border-yellow-500 focus:outline-none transition" 
                    placeholder="在此寫下您的心得..."
                    oninput="autoResize(this); saveToLocalStorage();"></textarea>
            </div>
        </div>

        <div class="mt-10 bg-gray-800 p-6 rounded-lg border border-gray-700">
            <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-2">
                <h2 class="text-xl font-bold text-yellow-500">2025 石抽卡候選區</h2>
                <span class="text-xs text-gray-400">點擊此區域可放回卡片</span>
            </div>
            <div id="pool" class="tier-row flex flex-wrap gap-2 min-h-[150px]" onclick="handleRowClick(this, true)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10828.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10841.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10842.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10852.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10853.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10854.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10857.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10872.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10862.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10874.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10875.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10891.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10892.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10895.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10896.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10898.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10899.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10916.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10919.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10931.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10932.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10936.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10938.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10939.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10942.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10948.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/2931.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/2932.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/2933.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10950.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10953.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10967.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10968.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10970.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10972.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10973.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10980.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10981.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10982.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10992.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/10993.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11015.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/2941.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/2942.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/2943.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/2944.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/2945.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11027.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11028.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11029.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11031.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11043.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11044.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11036.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11045.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11053.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11055.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11070.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11071.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11072.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11076.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11090.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
                <img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/11091.jpg" class="character-item rounded shadow-md" onclick="handleItemClick(event, this)">
            </div>
        </div>
    </div>

    <script>
        let selectedElement = null;

        // 強制處理圖片 CORS 問題並繞過快取
        function fixImageCORS() {
            const images = document.querySelectorAll('img');
            images.forEach(img => {
                const currentSrc = img.src;
                // 如果 src 還沒加上 nocache，才進行處理
                if (!currentSrc.includes('nocache=')) {
												
                    img.setAttribute('crossorigin', 'anonymous');
                    const separator = currentSrc.includes('?') ? '&' : '?';
                    // 加上時間戳，確保瀏覽器請求全新的授權版本
                    img.src = currentSrc + separator + 'nocache=' + new Date().getTime();
                }
            });
        }

        // 卡片點擊選取邏輯
        function handleItemClick(event, element) {
            event.stopPropagation();

   
            if (selectedElement && selectedElement !== element) {
                selectedElement.classList.remove('selected-item');
            }

   
            if (selectedElement === element) {
                element.classList.remove('selected-item');
                selectedElement = null;
            } else {
                element.classList.add('selected-item');
                selectedElement = element;
            }
        }

        // 放置卡片邏輯
        function handleRowClick(container, isPool = false) {
            if (!selectedElement) return;

 
            const targetRow = isPool ? container : container.querySelector('.tier-row');
   
            if (targetRow) {
                targetRow.appendChild(selectedElement);
                selectedElement.classList.remove('selected-item');
                selectedElement = null;
                saveToLocalStorage();
            }
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        // 儲存至本地瀏覽器
        function saveToLocalStorage() {
            const tierData = document.getElementById('tier-container').innerHTML;
            const poolData = document.getElementById('pool').innerHTML;
            const commentData = document.getElementById('comment-box').value;
			
            localStorage.setItem('tosTierV4', tierData);
            localStorage.setItem('tosPoolV4', poolData);
            localStorage.setItem('tosCommentV4', commentData);
        }

        // 載入儲存的數據
        function loadFromLocalStorage() {
            const savedTiers = localStorage.getItem('tosTierV4');
            const savedPool = localStorage.getItem('tosPoolV4');
            const savedComment = localStorage.getItem('tosCommentV4');
			
            if (savedTiers) document.getElementById('tier-container').innerHTML = savedTiers;
            if (savedPool) document.getElementById('pool').innerHTML = savedPool;
            if (savedComment) {
                const cb = document.getElementById('comment-box');
                cb.value = savedComment;
                autoResize(cb);
            }
            // 載入後立即修復圖片授權問題
            fixImageCORS();
        }

        // 下載圖片邏輯
        async function downloadList() {
            if (selectedElement) selectedElement.classList.remove('selected-item');
            const area = document.getElementById('capture-area');

            // 確保所有區域內的圖片都載入完成再擷取
            const imgs = area.querySelectorAll('img');
            const promises = Array.from(imgs).map(img => {
                if (img.complete) return Promise.resolve();
                return new Promise(resolve => {
                    img.onload = resolve;
                    img.onerror = resolve;
                });
            });
            await Promise.all(promises);

            html2canvas(area, { 
                useCORS: true,
                allowTaint: false,
                backgroundColor: "#000000",
                scale: 2 // 提升清晰度
		 
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = '2025-TOS-TierList.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        // 重置數據
        function resetList() {
            if(confirm('確定要清空並重置所有數據嗎？')) {
                localStorage.clear();
			   
			  
                location.reload();
            }
        }

		  
        window.onload = loadFromLocalStorage;
	   
	
    </script>
</body>
</html>
